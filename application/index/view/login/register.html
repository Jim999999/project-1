<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>欢迎{if($action == 'login')}登录{else}注册{/if}</title>
    <!-- load layui -->
    {include file='layouts/layui'}
    <!-- 加载公共文件  -->
    <link  href="__CMS__/css/zhang.css" rel="stylesheet">
    <script type='text/javascript' src="__CMS__/js/moZhang.js" ></script>

</head>
<body id="body-login">
<div class="div-video">
    <video class="video-player" preload="auto" autoplay="autoplay" loop="loop">
        <source src="__CMS__/file/loginVideo.mp4" type="video/mp4">
    </video>
</div>

<div class="video_mask"></div>
<div class="div-login">
    <form class="layui-form layui-form-pane"  id="form-login">
        {if($action == 'register')}
       <div class="layui-form-item">
            <label class="layui-form-label">用户</label>
            <div class="layui-input-inline">
                <input type="text" name="c_name" required
                       lay-verify="required" placeholder="请输入用户名"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        {/if}
        <div class="layui-form-item">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-inline">
                <input type="text" name="phone" required
                       lay-verify="required" placeholder="请输入手机号"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="password" name="passwd" required
                       lay-verify="required" placeholder="请输入密码"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block div-form-op">
                <button class="layui-btn btn-login" type="button" onclick="adminLogin()"
                        lay-submit lay-filter="formDemo">
                    {if($action == 'login')}登录{else}注册{/if}
                </button>
                <a href="#" onclick="self.location=document.referrer;"  class="layui-btn layui-btn-primary">返回</a>
            </div>
        </div>
    </form>
</div>

</body>
<script>
    window.onload = function(){
        //要初始化的东西 TODO 我就奇怪为啥有的代码在$(document).function()中就不行！！！
        $(window).resize(function(){
            if($(".video-player").width() > $(window).width()){
                $(".video-player").css({"height":$(window).height(),"width":"auto","left":-($(".video-player").width()-$(window).width())/2});
            }else{
                $(".video-player").css({"width":$(window).width(),"height":"auto","left":-($(".video-player").width()-$(window).width())/2});
            }
        }).resize();
    };
    $(document).on('keydown', function() {
        if(event.keyCode == 13) {
            $(".btn-login").click();
        }
    });
    function adminLogin() {
        {if($action=='login')}
            var toUrl = "{:url('/login/ajaxLogin')}";
        {else}
            var toUrl = "{:url('/login/ajaxRegister')}";
        {/if}
        var postData = $("#form-login").serialize();
        var indexUrl = "{:url('/index/index')}";
        $.post(
            toUrl,
            postData,
            function (result) {
                if(result.status == 1){
                    window.location.href = indexUrl;
                }else{
                    //失败
                    layer.msg(result.message);
                }
            },"JSON");
    }
</script>
</html>